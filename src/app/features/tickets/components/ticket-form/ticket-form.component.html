<div class="max-w-2xl mx-auto">
  <div class="mb-6">
    <h1
      class="text-2xl font-bold text-slate-800 dark:text-white transition-colors"
      *ngIf="!isEditMode"
    >
      Novo Chamado
    </h1>
    <h1
      class="text-2xl font-bold text-slate-800 dark:text-white transition-colors"
      *ngIf="isEditMode"
    >
      Editar Chamado
    </h1>
    <p class="text-slate-500 dark:text-slate-400 transition-colors">
      Preencha as informações abaixo para
      {{ isEditMode ? "atualizar a" : "abrir uma" }} solicitação.
    </p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-20">
    <div
      class="animate-spin rounded-full h-12 w-12 border-b-2 border-accent mx-auto mb-4"
    ></div>
    <p class="text-slate-500 dark:text-slate-400 transition-colors">
      Carregando chamado...
    </p>
  </div>

  <!-- Feedback -->
  <div
    *ngIf="notification && !isLoading"
    [class]="
      'mb-6 p-4 rounded-lg flex items-center gap-3 border transition-colors ' +
      (notification.type === 'success'
        ? 'bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-300 border-green-200 dark:border-green-800'
        : 'bg-red-50 dark:bg-red-950 text-red-700 dark:text-red-300 border-red-200 dark:border-red-800')
    "
    role="alert"
  >
    <span class="font-medium">{{ notification.message }}</span>
  </div>

  <form
    *ngIf="!isLoading"
    [formGroup]="ticketForm"
    (ngSubmit)="onSubmit()"
    class="bg-white dark:bg-slate-900 p-6 md:p-8 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm dark:shadow-slate-950/20 space-y-6 transition-colors"
  >
    <!-- Title Field -->
    <div>
      <label
        for="title"
        class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1 transition-colors"
      >
        Título da Solicitação
        <span class="text-red-500" aria-label="obrigatório">*</span>
      </label>
      <input
        id="title"
        type="text"
        formControlName="title"
        class="w-full px-4 py-2 rounded-lg border bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-50 focus:ring-2 transition-all outline-none dark:border-slate-600"
        [class.border-red-300]="isFieldInvalid('title')"
        [class.dark:border-red-800]="isFieldInvalid('title')"
        [class.focus:ring-red-100]="isFieldInvalid('title')"
        [class.dark:focus:ring-red-950]="isFieldInvalid('title')"
        [class.border-slate-200]="!isFieldInvalid('title')"
        [class.focus:border-accent]="!isFieldInvalid('title')"
        placeholder="Ex: Computador não liga"
        autocomplete="off"
        aria-label="Título da solicitação"
      />
      <div class="flex justify-between mt-1">
        <p
          *ngIf="isFieldInvalid('title')"
          class="text-xs text-red-500 font-medium"
        >
          {{ getErrorMessage("title") }}
        </p>
        <span
          class="text-xs ml-auto transition-colors"
          [class.text-slate-400]="(ticketForm.get('title')?.value?.length || 0) < VALIDATION_RULES.TITLE_MAX_LENGTH * 0.8"
          [class.dark:text-slate-500]="(ticketForm.get('title')?.value?.length || 0) < VALIDATION_RULES.TITLE_MAX_LENGTH * 0.8"
          [class.text-amber-500]="(ticketForm.get('title')?.value?.length || 0) >= VALIDATION_RULES.TITLE_MAX_LENGTH * 0.8 && (ticketForm.get('title')?.value?.length || 0) < VALIDATION_RULES.TITLE_MAX_LENGTH"
          [class.text-red-500]="(ticketForm.get('title')?.value?.length || 0) >= VALIDATION_RULES.TITLE_MAX_LENGTH"
        >
          {{ ticketForm.get("title")?.value?.length || 0 }} /
          {{ VALIDATION_RULES.TITLE_MAX_LENGTH }}
        </span>
      </div>
    </div>

    <!-- Category Field -->
    <div>
      <label
        for="category"
        class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1 transition-colors"
      >
        Categoria
      </label>
      <div class="relative">
        <select
          id="category"
          formControlName="category"
          class="w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-50 focus:border-accent focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-950 transition-all outline-none appearance-none"
          aria-label="Categoria do chamado"
        >
          <option *ngFor="let cat of categories" [value]="cat">
            {{ cat }}
          </option>
        </select>
        <div
          class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none"
        >
          <svg
            class="w-4 h-4 text-slate-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            ></path>
          </svg>
        </div>
      </div>
    </div>

    <!-- Priority Field -->
    <div>
      <label
        for="priority"
        class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1 transition-colors"
      >
        Prioridade
        <span class="text-red-500" aria-label="obrigatório">*</span>
      </label>
      <div class="relative">
        <select
          id="priority"
          formControlName="priority"
          class="w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-50 focus:border-accent focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-950 transition-all outline-none appearance-none"
          aria-label="Prioridade da solicitação"
        >
          <option *ngFor="let priority of priorities" [value]="priority">
            {{ priority }}
          </option>
        </select>
        <div
          class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-slate-400 dark:text-slate-500"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            ></path>
          </svg>
        </div>
      </div>
    </div>

    <!-- Status Field (Edit mode only) -->
    <div *ngIf="isEditMode">
      <label for="status" class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1 transition-colors">
        Status
        <span class="text-red-500" aria-label="obrigatório">*</span>
      </label>
      <div class="relative">
        <select
          id="status"
          formControlName="status"
          class="w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-50 focus:border-accent focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-950 transition-all outline-none appearance-none"
          aria-label="Status do chamado"
        >
          <option *ngFor="let status of statuses" [value]="status">
            {{ status }}
          </option>
        </select>
        <div
          class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-slate-400 dark:text-slate-500"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            ></path>
          </svg>
        </div>
      </div>
    </div>

    <!-- Description Field -->
    <div>
      <label
        for="description"
        class="block text-sm font-medium text-slate-700 dark:text-slate-200 mb-1 transition-colors"
      >
        Descrição Detalhada
        <span class="text-red-500" aria-label="obrigatório">*</span>
      </label>
      <textarea
        id="description"
        rows="5"
        formControlName="description"
        class="w-full px-4 py-2 rounded-lg border bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-50 focus:ring-2 transition-all outline-none resize-none dark:border-slate-600"
        [class.border-red-300]="isFieldInvalid('description')"
        [class.dark:border-red-800]="isFieldInvalid('description')"
        [class.focus:ring-red-100]="isFieldInvalid('description')"
        [class.dark:focus:ring-red-950]="isFieldInvalid('description')"
        [class.border-slate-200]="!isFieldInvalid('description')"
        [class.focus:border-accent]="!isFieldInvalid('description')"
        placeholder="Descreva o problema com o máximo de detalhes possível..."
        aria-label="Descrição detalhada do chamado"
      ></textarea>
      <div class="flex justify-between mt-1">
        <p
          *ngIf="isFieldInvalid('description')"
          class="text-xs text-red-500 font-medium"
        >
          {{ getErrorMessage("description") }}
        </p>
        <span
          class="text-xs ml-auto transition-colors"
          [class.text-slate-400]="(ticketForm.get('description')?.value?.length || 0) < VALIDATION_RULES.DESCRIPTION_MAX_LENGTH * 0.8"
          [class.dark:text-slate-500]="(ticketForm.get('description')?.value?.length || 0) < VALIDATION_RULES.DESCRIPTION_MAX_LENGTH * 0.8"
          [class.text-amber-500]="(ticketForm.get('description')?.value?.length || 0) >= VALIDATION_RULES.DESCRIPTION_MAX_LENGTH * 0.8 && (ticketForm.get('description')?.value?.length || 0) < VALIDATION_RULES.DESCRIPTION_MAX_LENGTH"
          [class.text-red-500]="(ticketForm.get('description')?.value?.length || 0) >= VALIDATION_RULES.DESCRIPTION_MAX_LENGTH"
        >
          {{ ticketForm.get("description")?.value?.length || 0 }} /
          {{ VALIDATION_RULES.DESCRIPTION_MAX_LENGTH }}
        </span>
      </div>
    </div>

    <!-- Buttons -->
    <div
      class="pt-4 border-t border-slate-100 dark:border-slate-700 flex flex-col-reverse md:flex-row items-center justify-end gap-3"
    >
      <button
        type="button"
        routerLink="/"
        class="w-full md:w-auto px-5 py-2.5 rounded-lg border border-slate-200 dark:border-slate-600 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800 font-medium transition-colors flex items-center justify-center gap-2"
      >
        Cancelar
      </button>
      <button
        type="submit"
        [disabled]="isSubmitting"
        class="w-full md:w-auto px-5 py-2.5 rounded-lg text-white font-medium shadow-sm flex items-center justify-center gap-2 transition-all"
        [class.bg-blue-400]="isSubmitting"
        [class.cursor-not-allowed]="isSubmitting"
        [class.bg-accent]="!isSubmitting"
        [class.hover:bg-blue-600]="!isSubmitting"
        [attr.aria-busy]="isSubmitting"
      >
        <span
          *ngIf="isSubmitting"
          class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"
          aria-hidden="true"
        ></span>
        <span>{{
          isSubmitting
            ? "Salvando..."
            : isEditMode
            ? "Atualizar Chamado"
            : "Salvar Chamado"
        }}</span>
      </button>
    </div>
  </form>
</div>
